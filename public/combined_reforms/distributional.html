<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distributional Impact - Combined Autumn Budget 2025</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 16px; font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: white; }
        #chart { width: 100%; height: 500px; }
    </style>
</head>
<body>
    <div id="chart"></div>
    <script>
        const data = {"2026-27": [669.9, 1139.5, 440.1, 363.7, 211.8, 152.7, 140.5, 183.4, 164.7, 170.0], "2027-28": [655.3, 1155.5, 441.8, 309.2, 146.1, 91.2, 54.5, 72.9, 56.0, 59.8], "2028-29": [458.4, 1446.0, 338.4, 283.1, 39.2, -36.7, -156.0, -179.4, -290.9, -504.8], "2029-30": [441.9, 1434.7, 176.4, 216.2, -180.8, -231.9, -416.1, -526.9, -1028.2, -1449.0], "2030-31": [466.7, 1343.2, 235.8, 58.7, -202.0, -350.2, -576.2, -766.5, -1327.7, -1874.0]};
        const years = ["2026-27", "2027-28", "2028-29", "2029-30", "2030-31"];

        const traces = years.map((year, i) => {
            const values = data[year];
            const colors = values.map(v => v >= 0 ? '#319795' : '#D97706');
            return {
                x: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                y: values,
                type: 'bar',
                marker: { color: colors },
                text: values.map(v => v >= 0 ? '+£' + Math.round(v).toLocaleString() : '-£' + Math.round(Math.abs(v)).toLocaleString()),
                textposition: 'outside',
                textfont: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif", size: 10 },
                hovertemplate: 'Decile %{x}<br>Change: £%{y:,.0f}<extra></extra>',
                visible: i === 0,
                name: year
            };
        });

        const steps = years.map((year, i) => ({
            method: 'update',
            args: [{ visible: years.map((_, j) => j === i) }],
            label: year
        }));

        const layout = {
            xaxis: {
                title: 'Income decile',
                tickmode: 'array',
                tickvals: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                showgrid: true,
                gridcolor: '#E2E8F0'
            },
            yaxis: {
                title: 'Average change in household income (£/year)',
                tickprefix: '£',
                showgrid: true,
                gridcolor: '#E2E8F0',
                range: [-2000, 2000],
                zeroline: true,
                zerolinecolor: '#344054',
                zerolinewidth: 2
            },
            height: 500,
            margin: { l: 80, r: 50, b: 100, t: 60 },
            font: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif" },
            showlegend: false,
            sliders: [{
                active: 0,
                steps: steps,
                x: 0.2,
                len: 0.6,
                y: 1.1,
                currentvalue: { visible: false },
                font: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif" }
            }],
            updatemenus: [{
                type: 'buttons',
                showactive: false,
                x: 0.1,
                y: 1.15,
                xanchor: 'right',
                buttons: [{
                    label: 'Play',
                    method: 'animate',
                    args: [null, { frame: { duration: 1000, redraw: true }, fromcurrent: true, mode: 'afterall' }]
                }]
            }]
        };

        // Create frames for animation
        const frames = years.map(year => ({
            name: year,
            data: [{
                y: data[year],
                text: data[year].map(v => v >= 0 ? '+£' + Math.round(v).toLocaleString() : '-£' + Math.round(Math.abs(v)).toLocaleString()),
                marker: { color: data[year].map(v => v >= 0 ? '#319795' : '#D97706') }
            }]
        }));

        Plotly.newPlot('chart', traces, layout).then(() => {
            Plotly.addFrames('chart', frames);
        });
    </script>
</body>
</html>