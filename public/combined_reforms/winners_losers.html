<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winners and Losers - Combined Autumn Budget 2025</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 16px; font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: white; }
        #chart { width: 100%; height: 650px; }
    </style>
</head>
<body>
    <div id="chart"></div>
    <script>
        const data = {"2026-27": {"gain_more_5": [8.8, null, 4.2, 5.8, 4.9, 3.8, 5.7, 5.7, 11.2, 10.5, 23.0, 13.4], "gain_less_5": [43.7, null, 42.6, 47.5, 53.6, 50.2, 49.1, 50.9, 38.9, 36.5, 33.5, 33.5], "no_change": [47.6, null, 53.2, 46.7, 41.6, 46.0, 45.2, 43.5, 50.0, 53.1, 43.6, 53.2], "lose_less_5": [0.0, null, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], "lose_more_5": [0.0, null, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}, "2027-28": {"gain_more_5": [8.3, null, 3.7, 5.5, 4.7, 3.3, 5.0, 5.8, 10.0, 10.7, 22.1, 12.1], "gain_less_5": [42.5, null, 41.3, 44.4, 51.0, 46.7, 47.8, 47.7, 41.0, 35.7, 34.0, 35.1], "no_change": [45.5, null, 49.6, 41.3, 36.3, 43.6, 41.8, 44.9, 48.3, 53.3, 43.8, 52.8], "lose_less_5": [3.7, null, 5.5, 8.8, 8.0, 6.5, 5.4, 1.6, 0.6, 0.4, 0.2, 0.0], "lose_more_5": [0.0, null, 0.0, 0.1, 0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 0.0, 0.0]}, "2028-29": {"gain_more_5": [6.7, null, 1.8, 0.9, 2.8, 2.2, 3.2, 4.9, 8.5, 8.4, 24.3, 10.2], "gain_less_5": [12.8, null, 2.8, 3.3, 9.2, 10.9, 12.3, 13.3, 16.9, 13.7, 22.1, 24.9], "no_change": [8.7, null, 0.8, 0.4, 1.5, 2.9, 4.4, 5.6, 7.0, 11.4, 14.6, 40.7], "lose_less_5": [69.8, null, 91.9, 90.8, 84.7, 81.9, 78.4, 75.3, 64.7, 65.0, 37.9, 23.4], "lose_more_5": [2.0, null, 2.6, 4.6, 1.8, 2.1, 1.8, 0.9, 2.9, 1.5, 1.2, 0.7]}, "2029-30": {"gain_more_5": [4.7, null, 0.0, 0.0, 0.2, 0.2, 0.7, 1.4, 7.1, 7.0, 22.2, 8.9], "gain_less_5": [6.4, null, 0.2, 0.2, 2.9, 2.7, 6.9, 3.2, 7.4, 5.8, 13.2, 22.4], "no_change": [7.1, null, 0.3, 0.1, 0.9, 1.0, 3.8, 3.8, 5.8, 8.6, 12.1, 36.6], "lose_less_5": [77.1, null, 93.4, 91.7, 90.6, 91.8, 84.0, 87.2, 74.1, 75.1, 49.0, 30.1], "lose_more_5": [4.8, null, 6.1, 7.9, 5.5, 4.3, 4.7, 4.4, 5.6, 3.6, 3.6, 2.0]}, "2030-31": {"gain_more_5": [4.7, null, 0.0, 0.0, 0.1, 0.2, 0.5, 2.5, 5.4, 8.6, 20.9, 9.9], "gain_less_5": [6.3, null, 0.2, 0.3, 3.0, 2.9, 6.4, 2.8, 6.8, 6.0, 13.3, 22.8], "no_change": [6.8, null, 0.3, 0.1, 1.0, 1.0, 3.8, 4.2, 3.7, 8.3, 11.3, 36.4], "lose_less_5": [76.7, null, 91.2, 90.9, 89.3, 91.3, 84.2, 85.1, 78.2, 73.4, 50.4, 29.0], "lose_more_5": [5.5, null, 8.3, 8.7, 6.6, 4.6, 5.2, 5.3, 6.0, 3.7, 4.2, 2.0]}};
        const years = ["2026-27", "2027-28", "2028-29", "2029-30", "2030-31"];
        const yLabels = ["All", " ", "10", "9", "8", "7", "6", "5", "4", "3", "2", "1"];

        const categories = [
            { key: 'gain_more_5', name: 'Gain more than 5%', color: '#285E61', textColor: 'white' },
            { key: 'gain_less_5', name: 'Gain less than 5%', color: '#31979599', textColor: '#344054' },
            { key: 'no_change', name: 'No change', color: '#E2E8F0', textColor: '#344054' },
            { key: 'lose_less_5', name: 'Lose less than 5%', color: '#9CA3AF', textColor: '#344054' },
            { key: 'lose_more_5', name: 'Lose more than 5%', color: '#4B5563', textColor: 'white' }
        ];

        // Create initial traces for 2026-27
        const initialYear = years[0];
        const traces = categories.map(cat => {
            const values = data[initialYear][cat.key];
            return {
                name: cat.name,
                type: 'bar',
                orientation: 'h',
                x: values,
                y: yLabels,
                marker: { color: cat.color },
                text: values.map(v => v !== null && v > 0.5 ? v.toFixed(1) + '%' : ''),
                textposition: 'inside',
                textfont: { color: cat.textColor, size: 11, family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif" },
                hovertemplate: '%{y}<br>' + cat.name + ': %{x:.1f}%<extra></extra>',
                showlegend: true
            };
        });

        const steps = years.map((year, i) => ({
            method: 'animate',
            args: [[year], { frame: { duration: 800, redraw: true }, mode: 'immediate' }],
            label: year
        }));

        const layout = {
            barmode: 'stack',
            xaxis: {
                title: { text: 'Population share', font: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif", size: 14 } },
                tickfont: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif", size: 12 },
                showgrid: true,
                gridcolor: '#E2E8F0',
                range: [0, 100],
                tickformat: '.0f',
                ticksuffix: '%'
            },
            yaxis: {
                title: { text: 'Income decile', font: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif", size: 14 } },
                tickfont: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif", size: 12 },
                categoryorder: 'array',
                categoryarray: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', ' ', 'All'],
                type: 'category',
                automargin: true
            },
            height: 650,
            margin: { l: 80, r: 50, b: 120, t: 60 },
            plot_bgcolor: 'white',
            paper_bgcolor: 'white',
            font: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif" },
            legend: {
                orientation: 'h',
                yanchor: 'top',
                y: -0.12,
                xanchor: 'center',
                x: 0.5,
                font: { family: "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif", size: 10 },
                traceorder: 'normal',
                entrywidth: 100
            },
            sliders: [{
                active: 0,
                yanchor: 'middle',
                xanchor: 'center',
                currentvalue: { visible: false },
                transition: { duration: 800 },
                pad: { b: 10, t: 50, l: 80 },
                len: 0.7,
                x: 0.45,
                y: 1.15,
                steps: steps
            }],
            updatemenus: [{
                buttons: [{
                    args: [null, { frame: { duration: 1500, redraw: true }, fromcurrent: true, transition: { duration: 800 } }],
                    label: 'Play',
                    method: 'animate'
                }],
                direction: 'left',
                pad: { r: 10, t: 10 },
                showactive: false,
                type: 'buttons',
                x: 0.05,
                xanchor: 'left',
                y: 1.15,
                yanchor: 'middle'
            }]
        };

        // Create frames for animation
        const frames = years.map(year => ({
            name: year,
            data: categories.map(cat => {
                const values = data[year][cat.key];
                return {
                    x: values,
                    text: values.map(v => v !== null && v > 0.5 ? v.toFixed(1) + '%' : '')
                };
            })
        }));

        Plotly.newPlot('chart', traces, layout).then(() => {
            Plotly.addFrames('chart', frames);
        });
    </script>
</body>
</html>